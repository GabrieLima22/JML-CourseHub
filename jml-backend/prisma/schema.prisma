generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Course {
  id                String      @id @default(cuid())
  titulo            String
  slug              String      @unique
  categoria         String
  empresa           String
  tipo              String
  modalidade        String[]
  segmento          String
  data_inicio       DateTime?
  data_fim          DateTime?
  local             String?
  endereco_completo String?
  carga_horaria     Int
  summary           String
  description       String
  objetivos         String[]
  publico_alvo      String[]
  nivel             String
  professores       Json[]
  coordenacao       Json?
  investimento      Json
  forma_pagamento   String[]
  programacao       Json[]
  metodologia       String?
  pdf_original      String?
  pdf_url           String?
  landing_page      String?
  inscricao_url     String?
  tags              String[]
  deliverables      String[]
  related_ids       String[]
  views_count       Int         @default(0)
  clicks_count      Int         @default(0)
  conversions_count Int         @default(0)
  cor_categoria     String?
  icone             String?
  imagem_capa       String?
  status            String      @default("draft")
  destaque          Boolean     @default(false)
  novo              Boolean     @default(true)
  created_by        String?
  updated_by        String?
  created_at        DateTime    @default(now())
  updated_at        DateTime    @updatedAt
  published_at      DateTime?
  analytics         Analytics[]
  uploads           Upload[]

  @@index([empresa, tipo])
  @@index([categoria, segmento])
  @@index([status, published_at])
  @@index([destaque, novo])
  @@map("courses")
}

model User {
  id             String    @id @default(cuid())
  email          String    @unique
  name           String
  password       String
  role           String    @default("editor")
  permissions    String[]  @default(["read"])
  avatar         String?
  theme          String    @default("auto")
  language       String    @default("pt-BR")
  last_login     DateTime?
  login_count    Int       @default(0)
  email_verified Boolean   @default(false)
  two_factor     Boolean   @default(false)
  reset_token    String?
  reset_expires  DateTime?
  created_at     DateTime  @default(now())
  updated_at     DateTime  @updatedAt
  uploads        Upload[]  @relation("UploadedBy")

  @@map("users")
}

model Upload {
  id              String   @id @default(cuid())
  filename        String
  original_name   String
  size            Int
  mimetype        String
  path            String
  status          String   @default("pending")
  progress        Int      @default(0)
  extracted_data  Json?
  error_message   String?
  processing_time Int?
  ai_confidence   Float?
  manual_review   Boolean  @default(false)
  course_id       String?
  processed_by    String?
  created_at      DateTime @default(now())
  updated_at      DateTime @updatedAt
  course          Course?  @relation(fields: [course_id], references: [id])
  user            User?    @relation("UploadedBy", fields: [processed_by], references: [id])

  @@index([status, created_at])
  @@index([course_id])
  @@map("uploads")
}

model Analytics {
  id           String   @id @default(cuid())
  event_type   String
  course_id    String?
  search_query String?
  user_agent   String?
  ip_address   String?
  referrer     String?
  filters_used Json?
  session_id   String?
  created_at   DateTime @default(now())
  course       Course?  @relation(fields: [course_id], references: [id])

  @@index([event_type, created_at])
  @@index([course_id, created_at])
  @@map("analytics")
}

model Config {
  id          String   @id @default(cuid())
  key         String   @unique
  value       Json
  description String?
  updated_by  String?
  updated_at  DateTime @updatedAt

  @@map("config")
}
